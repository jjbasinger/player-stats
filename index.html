<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Bay Bros Wiffle — Player Stats</title>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"/>

<style>
body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:20px; color:#222; }
h1 { margin-bottom:10px; font-size:1.5rem; }
#tabs { margin-bottom:10px; display:flex; gap:8px; flex-wrap:wrap; }
.tab-btn { padding:6px 12px; border-radius:6px; border:1px solid #ddd; cursor:pointer; background:#fff; }
.tab-btn.active { background:#004466; color:#fff; border-color:#00334a; }
#table-wrap { margin-top:10px; }
table.dataTable thead { background:#004466; color:#fff; }
#no-data { color:#b00; margin-top:8px; display:none; }
</style>
</head>
<body>

<h1>Bay Bros Wiffle — Player Stats</h1>
<div id="tabs"></div>
<div id="table-wrap">
  <table id="stats-table" class="display" style="width:100%; display:none;">
    <thead></thead>
    <tbody></tbody>
  </table>
  <div id="no-data">Loading...</div>
</div>

<!-- libraries -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

<script>
(function(){
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS9PBgLUF3MZqsXOQnbV_nptNSKLfST-rRMwf8J7Py0LSc9G5NY_zjkN8WPHkA1HRR-6A8rn4MRudNF/pubhtml"; // replace with your published web page URL
  const tabsWrap = document.getElementById('tabs');
  const tableEl = $('#stats-table');
  const noDataEl = document.getElementById('no-data');
  let dataTable = null;
  let tablesData = [];
  let currentIndex = 0;

  function initDataTable(){
    if (dataTable) {
      try { dataTable.destroy(); } catch(e){}
    }
    tableEl.show();
    dataTable = tableEl.DataTable({
      paging: true,
      searching: true,
      info: true,
      order:[[1,'desc']],
      lengthMenu:[10,25,50,100],
      autoWidth:false,
      responsive:true
    });
  }

  function loadTable(index){
    if (!tablesData[index]) return;
    const t = tablesData[index];
    tableEl.find('thead').html(t.thead);
    tableEl.find('tbody').html(t.tbody);
    initDataTable();
    noDataEl.style.display = 'none';
    currentIndex = index;
    Array.from(tabsWrap.children).forEach((b,i)=>{
      b.classList.toggle('active', i===index);
    });
  }

  function createTabs(){
    tabsWrap.innerHTML = '';
    tablesData.forEach((t,i)=>{
      const btn = document.createElement('button');
      btn.className='tab-btn';
      btn.type='button';
      btn.textContent = t.name;
      btn.addEventListener('click', ()=>loadTable(i));
      tabsWrap.appendChild(btn);
    });
    if (tablesData.length>0) loadTable(0);
  }

  function loadSheet(){
    $.get(SHEET_URL, function(data){
      const html = $('<div>').html(data);
      const allTables = html.find('table');
      if (allTables.length===0){
        noDataEl.style.display='block';
        noDataEl.textContent='No tables found in published sheet.';
        return;
      }
      tablesData = [];
      allTables.each(function(i){
        const name = html.find('h1,h2,h3,h4,h5,h6').eq(i).text() || `Sheet ${i+1}`;
        tablesData.push({
          name: name,
          thead: $(this).find('thead').html(),
          tbody: $(this).find('tbody').html()
        });
      });
      createTabs();
    }).fail(function(){
      noDataEl.style.display='block';
      noDataEl.textContent='Error loading published sheet.';
    });
  }

  loadSheet();
})();
</script>

</body>
</html>
