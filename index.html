<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Bay Bros Wiffle — Player Stats</title>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"/>

<style>
body { font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial; margin:20px; background:#111; color:#fff; }
h1 { margin-bottom:12px; color:#fff; }
#tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
.tab-btn { padding:8px 12px; border-radius:6px; border:1px solid #555; cursor:pointer; background:#222; color:#fff; }
.tab-btn.active { background:#004466; color:#fff; border-color:#00334a; }

/* Dark table */
table.dataTable { color:#fff !important; background:none !important; }
table.dataTable thead { background:#222; color:#fff; }
table.dataTable tbody tr { background:none; color:#fff; }
table.dataTable tbody tr:nth-child(even) { background:#111; }
.dataTables_wrapper .dataTables_filter,
.dataTables_wrapper .dataTables_paginate,
.dataTables_wrapper .dataTables_info { color:#fff; }
#no-data { color:#f00; margin-top:8px; display:none; }

/* Sticky header */
.dataTables_scrollHeadInner thead th,
table.dataTable thead th {
    position: sticky;
    top: 0;
    z-index: 2;
    background:#222 !important;
}
.dataTables_scrollBody {
    max-height: 600px; /* adjust as needed */
    overflow-y: auto;
    overflow-x: auto;
}
</style>
</head>
<body>

<h1>Career Stats</h1>
<div id="tabs"></div>
<div style="overflow:auto;">
  <table id="stats-table" class="display" style="width:100%; display:none;">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>
<div id="no-data">Loading...</div>

<!-- JS libraries -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
(function(){
//////////////////////
// CONFIG — EDIT THESE
//////////////////////
const SHEETS_INFO = [
  { name: "Batting Stats", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS9PBgLUF3MZqsXOQnbV_nptNSKLfST-rRMwf8J7Py0LSc9G5NY_zjkN8WPHkA1HRR-6A8rn4MRudNF/pub?gid=782230934&single=true&output=csv" },
  { name: "Pitching Stats", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS9PBgLUF3MZqsXOQnbV_nptNSKLfST-rRMwf8J7Py0LSc9G5NY_zjkN8WPHkA1HRR-6A8rn4MRudNF/pub?gid=509746022&single=true&output=csv" }
];
//////////////////////

const tabsWrap = document.getElementById('tabs');
const tableEl = $('#stats-table');
const headerEl = tableEl.find('thead');
const bodyEl = tableEl.find('tbody');
const noDataEl = document.getElementById('no-data');
let dataTable = null;

function buildTable(rows){
  if(!rows || rows.length===0){
    tableEl.hide();
    noDataEl.style.display='block';
    noDataEl.textContent='No data found.';
    return;
  }
  noDataEl.style.display='none';
  tableEl.show();

  const header = rows[0];
  const bodyRows = rows.slice(1);

  if(!$.fn.DataTable.isDataTable('#stats-table')){
    // Build header once
    headerEl.empty();
    const trHeader = $('<tr>');
    header.forEach(col => trHeader.append(`<th>${col}</th>`));
    headerEl.append(trHeader);

    // Init DataTable
    dataTable = tableEl.DataTable({
      paging:false,
      searching:true,
      info:false,
      order:[[1,'desc']],
      scrollY: '600px',
    scrollX: true,
      scrollCollapse: true,
      autoWidth:false,
      responsive:true
    });

    // Load initial rows
    dataTable.clear();
    dataTable.rows.add(bodyRows);
    dataTable.draw();
  } else {
    // If columns differ between sheets → rebuild header
    const currentCols = dataTable.columns().header().toArray().map(h=>$(h).text());
    if (JSON.stringify(currentCols) !== JSON.stringify(header)) {
      dataTable.destroy();
      headerEl.empty();
      const trHeader = $('<tr>');
      header.forEach(col => trHeader.append(`<th>${col}</th>`));
      headerEl.append(trHeader);
      dataTable = tableEl.DataTable({
        paging:false,
        searching:true,
        info:false,
        order:[[1,'desc']],
        scrollY: '600px',
        scrollCollapse: true,
        autoWidth:false,
        responsive:true
      });
    }
    // Replace rows
    dataTable.clear();
    dataTable.rows.add(bodyRows);
    dataTable.draw();
  }
}

function loadSheet(url){
  noDataEl.style.display='block';
  noDataEl.textContent='Loading...';
  tableEl.hide();
  Papa.parse(url, {
    download:true,
    skipEmptyLines:true,
    complete:function(results){
      buildTable(results.data);
      noDataEl.style.display='none';
    },
    error:function(err){
      noDataEl.style.display='block';
      noDataEl.textContent='Error fetching CSV: '+err.message;
    }
  });
}

function renderTabs(){
  tabsWrap.innerHTML='';
  SHEETS_INFO.forEach((sheet,i)=>{
    const btn = document.createElement('button');
    btn.className='tab-btn';
    btn.textContent = sheet.name;
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      loadSheet(sheet.url);
    });
    tabsWrap.appendChild(btn);

    if(i===0){
      btn.classList.add('active');
      loadSheet(sheet.url);
    }
  });
}

renderTabs();
})();
</script>

</body>
</html>
